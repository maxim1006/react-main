# тут указываю какой нужен image https://hub.docker.com/_/node
# обязательно указываю имадж с конкретной версией
FROM node:17.0.1-alpine

# начало приложения, все общение с докером будет начинаться с /app
WORKDIR /app

# копирую в рут имаджа, обязательно делаю этот шаг, так как если отдельно не копировать package.json то
# а сперва весь объект то nom i будет вызываться каждый раз, так как докер проверяет поменялся ли файл и если да
# то перезапускает все последующие команды, а так перезапустится npm i только если поменялось что-то в package*.json
COPY package*.json .

RUN npm i

# копирую текущую папку в рут докер образа (первый путь на моем компе, второй в имадже)
COPY . .

# задаю env переменные
ENV PORT=8080

EXPOSE 8080

# могу переходить внутри образа в любую директорию
# WORKDIR /app

# хорошая практика создавать юзера и задавать ему права
# пример создания юзера
#RUN groupadd -r max && useradd -g max max

# в пакете node уже есть созданный юзер: node, ограничиваю его права на папку апп
RUN chown -R node:node /app

User node

# тут в отличие от RUN команды пишу подряд каждое слово в кавычках
CMD ["npm", "start"]
